# 栈空间与堆空间

## 相关概念

我们把在使用之前就需要确认其变量数据类型的编程语言称为静态语⾔（如 C++、Java）。 

相反地，我们把在运行过程中需要检查数据类型的语言称为动态语⾔（比如 JavaScript）。

我们将可以偷偷转换数据类型的操作称为隐式类型转换。支持隐式类型转换的语⾔称为弱类型语⾔，不支持隐式类型转换的语⾔称为强类型语⾔。

因此，JavaScript 是⼀种弱类型的、动态的语⾔：

+ 弱类型，意味着你不需要告诉 JavaScript 引擎变量是什么数据类型，JavaScript 引擎在运行代码的时候自己会计算出来。 
+ 动态，意味着你可以使⽤同⼀个变量保存不同类型的数据。

JavaScript 的数据类型一共有 8 种：

`Boolean`、`Null`、`Undefined`、`Number`、`BigInt`、`String`、`Symbol` 和 `Object`。

前 7 种称为原始类型，最后一个对象类型称为引用类型。他们之间的其中一个差别就是在内存中存放的位置不一样。

## 内存空间

JS 的内存模型可以认为包含了从上到下三个空间：代码空间、栈空间和堆空间。

原始类型的数据直接保存在栈空间中；引用类型的数据保存在堆空间中，但是在栈空间中保存了整个引用类型数据的引用地址。

## 为什么需要堆空间

JavaScript 引擎需要用栈来维护程序执行期间上下文的状态，如果栈空间太大，所有的数据都存放在栈空间里面，那么会影响到上下文切换的效率，进而又影响到整个程序的执行效率。

所以通常情况下，栈空间都不会设置太大，主要用来存放⼀些原始类型的小数据。而引⽤类型的数据占用的空间都比较大，所以这⼀类数据会被存放到堆中，堆空间很大，能存放很多大的数据，不过缺点是分配内存和回收内存都会占用⼀定的时间。

# 垃圾回收机制

有些数据被使用之后，可能就不再需要了，那么这些数据被称为垃圾数据。如果这些垃圾数据⼀直保存在内存中，那么内存会越⽤越多，所以我们需要对这些垃圾数据进行回收，以释放有限的内存空间。

## 不同语言的垃圾回收策略

通常情况下，垃圾数据回收分为手动回收和自动回收两种策略。

C/C++ 使用手动回收策略，何时分配内存、何时销毁内存都是由代码控制的。C++ 中，如果某段数据已经不再需要了，但是又没有主动调用 `free` 函数来销毁，那么这种情况就被称为内存泄漏。

另外⼀种使用的是自动垃圾回收的策略，如 JavaScript、Java、Python 等语⾔，产⽣的垃圾数据是由垃圾回收器来释放的，并不需要手动通过代码来释放。

## 栈空间的数据回收方式

在栈空间中有一个记录当前执行状态的指针，称为 ESP。当某一个执行上下文结束的时候，JS 就会将 ESP 移动到下一个执行上下文，整个下移操作就是销毁了上一个执行上下文的过程。

这样上一个执行上下文虽然保存在栈空间当中，但是已经是无效内存了。而当有的数据要保存进来时，这一块内容就会覆盖掉。

## 堆空间的数据回收方式

在栈空间中，旧的执行上下文被移除后，仅仅是从栈空间中被移除了。但是如果这一段执行上下文含有堆空间的地址，那么对应堆空间的内存是不会被直接销毁的。而如果想要回收堆中的垃圾数据，就需要使用 JS 中的垃圾回收器。

## JS 中的垃圾回收机制

以后再写吧……
