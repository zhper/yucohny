# 平衡树

## 平衡树

平衡树 BT Balance Tree 指的是，任意节点的子树的高度差都小于等于 1。

常见的平衡树有 B 树、AVL树。

## 平衡二叉搜索树

平衡二叉搜索树有许多实现方式，如 AVL 树、Splay、Treap 等等。

平衡二叉搜索树英文为 Balance Binary Search Tree，所以在有些地方也会被简称为 BBST。

但是在更多地方，平衡树会默认指向平衡二叉搜索树，因此这篇笔记虽然主要是介绍 Splay 和 Treap 这两个平衡二叉搜索树，但是直接以平衡树对笔记进行命名。

且若无特殊说明，下文描述平衡树，均指平衡二叉搜索树。

## 平衡树的基本性质

二叉搜索树单次操作的最坏时间复杂度为 $O(n)$，而平衡树由于高度的限制，因此维护平衡树并实现若干查找功能的平均单次时间复杂度在 $O(\log_2 n)$

平衡树常见的操作如下：

1. 插入 x
2. 删除 x（若存在多个 x，则删除其中一个）
3. 查询 x 的数值排名
4. 查询数值排名为 x 的数
5. 求 x 的前驱
6. 求 x 的后继

上面的这几个操作在二叉搜索树中都有对应的解决办法，但是由于树的形态问题，时间复杂度可能会导致整个程序效率的崩坏。可以查看笔记 [二叉搜索树](./二叉搜索树/md)。

# Treap

Treap 这个单词是由 Tree 与 Heap 合成而来，因此中文也叫做 树堆，是有一个随机附加域满足堆的性质的二叉搜索树，其结构相当于以随机数据插入的二叉搜索树。相对于其他的平衡二叉搜索树，Treap的特点是实现简单，且能基本实现随机平衡的结构。

相比于普通的 BST，Treap 多了一个优先级的设定。

首先，Treap 的节点是满足 BST 性质。其次，Treap 的每一个节点还有一个优先级，而这些优先级又是满足堆的性质的。这就能让 Treap 的节点始终保持一种随机的状态。

而优先级的来源其实就是随机法。

## 旋转

旋转分为左旋和右旋。以左旋为例：

