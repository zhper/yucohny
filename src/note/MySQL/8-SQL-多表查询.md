与多表查询对应的，就是单表查询 DQL 语句。

# 多表关系

项目开发中，在进行数据库表结构设计时，会根据业务需求以及业务模块之间的关系，分析并设计表结构，由于业务之间相互关联，所以各个表结构之间也存在着各种联系，基本上分为三种：

+ 一对一
+ 一对多（多对一）
+ 多对多

## 一对一

实例：用户与用户详情

在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一（UNIQUE）。

## 一对多

实例：员工与部门

在「多」的一方建立外键，指向「一」的一方的主键。

## 多对多

实例：学生与课程

建立第三张中间表，中间表至少包含两个外键，分别关联两方主键。

# 多表查询概述

## 简单示例

```sql
select * from A, B;
```

假设上面的表 A 有 x 条数据，表 B 有 y 条数据，那么最终我们将会得到 x * y 条数据（笛卡尔积）。亦即对于 A 中的每条数据，B 中的每条数据都会进行组合。

在我们实际情况中，相当于是需要筛除无效的笛卡尔积结果：

```sql
select * from A, B where A.id = B.id;
```

## 多表查询分类

+ 连接查询

  + 内连接

    相当于查询 A、B 交集部分数据。

  + 外连接

    + 左外连接

      查询左表所有数据，以及两张表交集部分数据。

    + 右外连接

      查询右表所有数据，以及两张表交集部分数据。

  + 自连接

    当前表与自身的连接查询，自连接必须使用表别名。

+ 子查询

> 注意左外连接与右外连接，看起来最终的结果好像就是左表和右表的所有数据，但是是连接后的数据。

## 内连接

隐式内连接：

```sql
SELECT 字段列表 FROM 表1, 表2 WHERE 条件 ...;
```

显式内连接：

```sql
SELECT 字段列表 FROM 表1 [INNER] JOIN 表2 ON 连接条件;
```

隐式与显示的区别有下面两点：

1. 表的连接方式不同。
2. 条件的连接方式不同。

## 外连接

左外连接：

```sql
SELECT 字段列表 FROM 表1 LEFT [OUTER] JOIN 表2 ON 条件 ...;
```

右外连接：

```sql
SELECT 字段列表 FROM 表1 RIGHT [OUTER] JOIN 表2 ON 条件 ...;
```

## 自连接

```sql
SELECT 字段列表 FROM 表1 别名1 JOIN 表1 别名2 ON 条件...;
```

自连接查询，可以是内连接查询，也可以是外连接查询。

# 联合查询

联合查询就是把多次查询的结果合并在一起，形成一个新的查询结果集合，语法如下：

```sql
SELECT 字段列表 FROM 表 A...
UNION [ALL]
SELECT 字段列表 FROM 表 B...
```

> 注意：ALL 关键字表示不筛除重复结果，如果想要筛除重复结果，只需要使用 UNION 关键字即可。

联合查询的条件：联合查询的多张表的列数必须保持一致，字段类型也必须保持一致。

# 子查询

嵌套使用 SELECT 语句，称为嵌套查询，又称为子查询。

```sql
SELECT * FROM t1 WHERE column1 = (SELECT columns FROM t2)l
```

子查询外部的语句可以是 INSERT/UPDATE/DELETE/SELECT 中的任何一个。

根据子查询结果不同，可以分为：

+ 标量子查询（子查询结果为单个值）
+ 列子查询（子查询结果为 1 列）
+ 行子查询（子查询结果为 1 行）
+ 表子查询（子查询结果为多行多列）

## 标量子查询

略

## 列子查询

列子查询返回的结果是一列（可以是多行），这种子查询称为列子查询。

常用的操作符有：IN、NOT IN、ANY、SOME、ALL 等等。

+ IN

在指定的集合范围之内，多选一。

+ NOT IN

不在指定的集合范围之内

+ ANY

子查询返回列表中，有任意一个满足即可。

+ SOME

与 ANY 等同。

+ ALL

子查询返回列表的所有值都必须满足。

## 行子查询

示例：

```sql
select * from emp where (salary, managerid) = (select salary, managerid from emp where name = '小白');
```

## 表子查询

示例：

```sql
select * from emp where (job, salary) in (select job, salary from emp where name = '小白' or name = '小红');
```

